---

- hosts: all
  become: true
  tasks:

  - name: install apache and php 
    package:
      name: 
        - "{{ apache_package }}"
        - "{{ php_package }}"
      state: latest
      update_cache: yes

  - name: change e-mail address for admin
    tags: ubuntu
    lineinfile:
      path: /etc/apache2/apache2.conf
      regexp: '^Timeout'
      line: Timeout 350
    when: ansible_distribution == "Ubuntu"
    register: apache2_config_change

  - name: restart apache2
    service:
      name: apache2
      state: restarted
    when: apache2_config_change.changed


  - name: copy default html file to site
    tags: ubuntu
    copy:
      src: default_site.html
      dest: /var/www/html/index.html
      owner: root
      group: root
      mode: 0644
  
  - name: start httpd (CentOS)
    tags: apache,centos,httpd
    service:
      name: httpd
      state: started
      enabled: yes
    when: ansible_distribution == "CentOS"

- hosts: ubuntu
  become: true
  tasks:

  - name: create ansible user
    tags: always
    user:
      name: ansible
      groups: root
  
  - name: add ssh key for ansible user
    authorized_key:
      key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDNunQWwy0KTqJwUh5JseRf15VbuVadS3t8f0j/kmsrqL5SF32xxH6U3RhsnYPfB9l8JWLr/+vne/yaI7m04xhknHEQE4o1wrdAYouYeZPaNPAsHwq64GD2T6sDWkDCeoNn0B9Rkchmr5Cp76IG/q35EznIdsG4uQnpb44IxFWt6i6fWvGzr2U0n8KkpKrnYSzCyLeKpLjKr2YeX6AjnKmmO+E0+ys4x70jSD9splt5yVp7sk2ytHHtMAepCkXOKUJsYWlfTCNnFdeT2IB5e6DeE/e60lGLAs6I2mlHT0+FaIReKCjzy+o0ICZRv0wvGDDlCzdYMJpdLG/ItW+M8SWDTK+ewkJNeaWFG8sWnaEMIsk0wftMAZD8/gfgh1CoWZY9vcxV/ORctqGpumpAydR0GvdBODBxkJrG/XuSOkTJYBBNuXY8AR73vk0U5cCprwsLCw6pazDMWi5zJa15VXxoExbShLeuKXfpBWdZgfB89zb5v4YUwWtjvaEPiJYRNORtyZIZTenojesYgW0P22obeZ1buhTr3r5quRUIAtDr98ZyZdth3oItEB8oP0ZlR3rNE7Z/btu8rHd5zo4DRzBFjgjFKT+QihTq+CI2EM4DCoKs1LbQPmo2xc8bBSujdCwNqEymC1p4L9QHXPB+5JFso2F69ghCXFm9n3iQIWUYGQ== rbucurica@mavrck.co"
      user: ansible
  
  -name: add sudoers file for ansible
   tags: always
   copy:
     src: sudoers_ansible
     dest: /etc/sudoers.d/ansible
     owner: root
     group: root
     mode: 0440
  



